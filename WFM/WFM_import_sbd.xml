<?xml version="1.0"?>
<Setup StateDatabaseLocation="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER\WFM\1_WFM_test.db">
    <Log TimingLog="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER\WFM\2_Timing_WFM_test.csv"/>
	<Log ErrorLog="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER\WFM\3_Error_WFM_testcsv"/>
	<Log InfoLogFile="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER\WFM\4_InfoLogFile_WFM_test.txt"/>	
    <GroupTask name="Import SBDs">

        <SqlServer>localhost</SqlServer>
        <DatabaseName>Tests_vicente</DatabaseName>

        <GroupTask po="1" name="Define Variable Inputs">
			<SetPropertyTask po="1" name="Define Base Directory" input="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER" output="BaseDir" level="2" />	
			<SetPropertyTask po="2" name="Define NAVISCAN Logging Path" input="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER\SBD" output="NaviScanLoggingPath" level="2" />
			<GetParentFolderNamesTask po="3" name="Extract Project Name" path="{NaviScanLoggingPath}" output="ProjectFolderName" indexes="1" countfromtheleft="true" directoryseperator="\"/>
			<SplitVariablesTask po="4" name="Isolate Project Name" Input="{ProjectFolderName}" Seperator="\" Output0="blank1" Output1="ProjectName" Output2="blank2" />
			<SetPropertyTask po="5" name="Define Project Name" input="{ProjectName}" output="Proj_Name" level="2" />
            <SetPropertyTask po="1" name="Define WFM Log Path" input="C:\Users\Administrator\Documents\Vicente\TSS-FILE-CONVERTER\WFM" output="LogPath" level="2" />	
        </GroupTask>

        <FileWatcherTask po="2" name="Detect and Process SBD Files" logKeyword="Detect and Process SBD Files" Output="SBDFile" Location="{NaviScanLoggingPath}" Filter="*.sbd" Timeout="60000" IncludeSubDir="true"> 
        <GroupTask po="1" name="Process_{SBDFile.Filename}_Data">

		<GroupTask po="1" name="{SBDFile.Filename}">
						
			<OverwritePropertyTask po="1" name="{SBDFile.Filename} - Define SBD File Name" logKeyword="{SBDFile.Filename}" input="{SBDFile.NameWithoutExtension}" output="SBDFileName" level="2" />							

			<!--<GetParentFolderNamesTask po="2" name="{SBDFile.Filename} - Extract SBD Platform Subfolder" logKeyword="{SBDFile.Filename}" path="{SBDFile}" output="SBDWPlatSubFolder" indexes="3" countfromtheleft="true" directoryseperator="\"/>
			<SplitVariablesTask po="3" name="{SBDFile.Filename} - Identify SBD Platform Subfolder" Input="{SBDWPlatSubFolder}" Seperator="\" Output0="blank1" Output1="PlatSubFolderName" Output2="blank2" />	
			<RegExpTask po="4" name="{SBDFile.Filename} - Extract SBD Platform Name" logKeyword="{SBDFile.Filename}" Input="{PlatSubFolderName}" Expression="\S+_([a-zA-Z]+[0-9]+_*[a-zA-Z]*[0-9]*)" Group1="PlatName"/>	-->		
			<OverwritePropertyTask po="5" name="{SBDFile.Filename} - Define SBD Platform Name" logKeyword="{SBDFile.Filename}" input="PROV_WROV" output="PlatformName" level="2" />

			<GetParentFolderNamesTask po="6" name="{SBDFile.Filename} - Extract SBD Level 1 Subfolder" logKeyword="{SBDFile.Filename}" path="{SBDFile}" output="SBDLvl1SubFolder" indexes="5" countfromtheleft="true" directoryseperator="\"/>			
			<SplitVariablesTask po="7" name="{SBDFile.Filename} - Identify SBD Level 1 Subfolder" Input="{SBDLvl1SubFolder}" Seperator="\" Output0="blank1" Output1="Level1SubFolderName" Output2="blank2" />	
			<OverwritePropertyTask po="8" name="{SBDFile.Filename} - Define SBD Level 1 Subfolder" logKeyword="{SBDFile.Filename}" input="{Level1SubFolderName}" output="Level1Folder" level="2" />	

			<GetParentFolderNamesTask po="9" name="{SBDFile.Filename} - Extract Remaining SBD Subfolder Path" logKeyword="{SBDFile.Filename}" path="{SBDFile}" output="SBDSubFolderPath" indexes="6 7 8 9 10 11 12 13 14 15" countfromtheleft="true" directoryseperator="\"/>			
			<OverwritePropertyTask po="10" name="{SBDFile.Filename} - Define Remaining SBD Subfolder Path" logKeyword="{SBDFile.Filename}" input="{SBDSubFolderPath}" output="SBDSubFolder" level="2" />	

			<SetTitleTask po="11" name="Set WorkFlow Title" title="Monitoring for SBD Files - NAVISCAN\05_{PlatformName}\{Level1Folder}{SBDSubFolder}" size="25" red="255" green="255" blue="0" />
				
				<SbdImportTask po="12" name="{SBDFile.Filename} - Import into JobPlanner" logKeyword="{SBDFile.Filename}" output="SBDSQLBlockID" OnError="Restart">
					<NaviEditTask version="1.0">
						<Input xml="{SqlServer}"/>
						<Input xml="{DatabaseName}"/>
						<Geodesy useSbdGeodesy="yes">
						</Geodesy>
						<SbdInterpreter version="1.0">
							<Destination matchFolder="yes" importSVP="no" linkSVP="no">
								<Folder>\01_NaviScan_SBD</Folder>
							</Destination>
							<Source>
								<FileList>
									{SBDFile} 
								</FileList>
							</Source>
							<Filters>
								<MBEQuality setDeletedFlag="no" qualityThreshold="0"/>
							</Filters>
							<Options disableBathy="no" useOnlineSV="no" onlineSVStart="-1.1" onlineSVEnd="15.5" scanReductionImportEvery="1" />
						</SbdInterpreter>
					</NaviEditTask>
				</SbdImportTask>
        </GroupTask>
        </GroupTask>
        </FileWatcherTask>
    </GroupTask>
</Setup>