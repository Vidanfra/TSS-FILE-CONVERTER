<?xml version="1.0"?>
<!--
    ================================================================================
    EIVA WORKFLOW MANAGER - DEPTH EXPORT SCRIPT FOR DVL ALTITUDE FIXER
    ================================================================================
-->
<Setup StateDatabaseLocation=".\LOGS_WFM_DVL_Fixer\1_WFM_depth_export.db">
    <Log TimingLog=".\LOGS_WFM_DVL_Fixer\2_Timing_WFM_depth_export.csv"/>
	<Log ErrorLog=".\LOGS_WFM_DVL_Fixer\3_Error_WFM_depth_export.csv"/>
	<Log InfoLogFile=".\LOGS_WFM_DVL_Fixer\4_InfoLogFile_WFM_depth_export.txt"/>	
				
	<GroupTask name="Export Depth Navigation">

        <SqlServer>localhost</SqlServer>
        <DatabaseName>600090_GOEL_WindMultiplikator</DatabaseName>

        <GroupTask po="1" name="Data selection and setup">
            <!-- Output Directory -->
            <InputTask po="5" name="Select OUTPUT folder (for Depth Nav exports)" output="OutputDirectory" AskForInput="true" Message="Select OUTPUT folder (for Depth Nav exports)"/>
            <SetPropertyTask po="6" name="Define output directory" input="{OutputDirectory}" output="OutputDirectory" level="2"/>
        </GroupTask>

        <GroupTask po="2" name="Define Variable Inputs">
            <SetPropertyTask po="1" name="CRP ID" input="1" output="crp_id" level="2"/>        <!-- Common Reference Point -->
            <SetPropertyTask po="2" name="PORT ID" input="2" output="port_id" level="2"/>      <!-- Port side coil/sensor -->
            <SetPropertyTask po="3" name="CENTER ID" input="3" output="center_id" level="2"/>  <!-- Center coil/sensor -->
            <SetPropertyTask po="4" name="STBD ID" input="4" output="stbd_id" level="2"/>      <!-- Starboard coil/sensor -->
        </GroupTask>

        <!-- Find Blocks in the specified Job (Folder) -->
        <FindBlocksTask po="4" name="Iterate Blocks in Job" output="Block">
            <NaviEditTask version="1.0">
                <SqlServer>{SqlServer}</SqlServer>
                <DatabaseName>{DatabaseName}</DatabaseName>
                <FindBlocks version="1.0" blockType="-1" ignoreMbeBlocks="no" dbPath="\{NEPath}" includeSubFolders="true" firstTime="0" lastTime="0"/>
            </NaviEditTask>
            
            <GroupTask po="1" name="Export {Block.name}">
                
                <SetTitleTask po="1" name="Set WorkFlow Title" title="Exporting Depth: {Block.name}" size="25" red="0" green="255" blue="0" />

                <!-- ==================== EXPORT DEPTH NAV - CRP ==================== -->
                <ExportAsciiTask po="11" name="{Block.name} - Export Depth Nav CRP" logKeyword="DEPTHxport" output=" ">
                    <NaviEditTask version="1.0">
                        <SqlServer>{SqlServer}</SqlServer>
                        <DatabaseName>{DatabaseName}</DatabaseName>
                        <Export type="xyz_kpdoldepth">
                            <BlockId>
                                {Block.id}
                            </BlockId>

                            <Output>
                                <Location outputMethod="0" prefixKPRange="no" combineFiles="no" sortCombined="no">
                                    <Path>{OutputDirectory}</Path>
                                    <AppendPath></AppendPath>
                                </Location>

                                <DbFolderUsage createSubdir="no" prefixFileName="no" useAsFilename="no"/>
                                <Options writeHeader="yes" selectionMethod="0" reduceMethod="0" sortKP="no" interval="10.0"/>
                            </Output>
                            <Units depthScale="1.0" posScale="1.0"/>
                            <Settings addRunlineName="no">
                                <Selection object="{crp_id}"/> 
                                <Singlebeam maxInterpolDist="-1" interpolateDepth="yes"/>
                                <Multibeam averagingWindow="1.0"/> 
                                <NoOfDecimals position="3" depth="3" />
                                <Options downsampleFactor="0" downsampleMinDist="0.0" timeFormat="0" />
                            </Settings>
                        </Export>
                    </NaviEditTask>
                </ExportAsciiTask>

                <!-- ==================== EXPORT DEPTH NAV - PORT ==================== -->
                <ExportAsciiTask po="12" name="{Block.name} - Export Depth Nav PORT Coil" logKeyword="DEPTHxport" output=" ">
                    <NaviEditTask version="1.0">
                        <SqlServer>{SqlServer}</SqlServer>
                        <DatabaseName>{DatabaseName}</DatabaseName>
                        <Export type="xyz_kpdoldepth">
                            <BlockId>
                                {Block.id}
                            </BlockId>

                            <Output>
                                <Location outputMethod="0" prefixKPRange="no" combineFiles="no" sortCombined="no">
                                    <Path>{OutputDirectory}</Path>
                                    <AppendPath></AppendPath>
                                </Location>

                                <DbFolderUsage createSubdir="no" prefixFileName="no" useAsFilename="no"/>
                                <Options writeHeader="yes" selectionMethod="0" reduceMethod="0" sortKP="no" interval="10.0"/>
                            </Output>
                            <Units depthScale="1.0" posScale="1.0"/>
                            <Settings addRunlineName="no">
                                <Selection object="{port_id}"/> 
                                <Singlebeam maxInterpolDist="-1" interpolateDepth="yes"/>
                                <Multibeam averagingWindow="1.0"/> 
                                <NoOfDecimals position="3" depth="3" />
                                <Options downsampleFactor="0" downsampleMinDist="0.0" timeFormat="0" />
                            </Settings>
                        </Export>
                    </NaviEditTask>
                </ExportAsciiTask>

                <!-- ==================== EXPORT DEPTH NAV - CENTER ==================== -->
                <ExportAsciiTask po="13" name="{Block.name} - Export Depth Nav CENTER Coil" logKeyword="DEPTHxport" output=" ">
                    <NaviEditTask version="1.0">
                        <SqlServer>{SqlServer}</SqlServer>
                        <DatabaseName>{DatabaseName}</DatabaseName>
                        <Export type="xyz_kpdoldepth">
                            <BlockId>
                                {Block.id}
                            </BlockId>

                            <Output>
                                <Location outputMethod="0" prefixKPRange="no" combineFiles="no" sortCombined="no">
                                    <Path>{OutputDirectory}</Path>
                                    <AppendPath></AppendPath>
                                </Location>

                                <DbFolderUsage createSubdir="no" prefixFileName="no" useAsFilename="no"/>
                                <Options writeHeader="yes" selectionMethod="0" reduceMethod="0" sortKP="no" interval="10.0"/>
                            </Output>
                            <Units depthScale="1.0" posScale="1.0"/>
                            <Settings addRunlineName="no">
                                <Selection object="{center_id}"/> 
                                <Singlebeam maxInterpolDist="-1" interpolateDepth="yes"/>
                                <Multibeam averagingWindow="1.0"/> 
                                <NoOfDecimals position="3" depth="3" />
                                <Options downsampleFactor="0" downsampleMinDist="0.0" timeFormat="0" />
                            </Settings>
                        </Export>
                    </NaviEditTask>
                </ExportAsciiTask>

                <!-- ==================== EXPORT DEPTH NAV - STARBOARD ==================== -->
                <ExportAsciiTask po="14" name="{Block.name} - Export Depth Nav STARBOARD Coil" logKeyword="DEPTHxport" output=" ">
                    <NaviEditTask version="1.0">
                        <SqlServer>{SqlServer}</SqlServer>
                        <DatabaseName>{DatabaseName}</DatabaseName>
                        <Export type="xyz_kpdoldepth">
                            <BlockId>
                                {Block.id}
                            </BlockId>

                            <Output>
                                <Location outputMethod="0" prefixKPRange="no" combineFiles="no" sortCombined="no">
                                    <Path>{OutputDirectory}</Path>
                                    <AppendPath></AppendPath>
                                </Location>

                                <DbFolderUsage createSubdir="no" prefixFileName="no" useAsFilename="no"/>
                                <Options writeHeader="yes" selectionMethod="0" reduceMethod="0" sortKP="no" interval="10.0"/>
                            </Output>
                            <Units depthScale="1.0" posScale="1.0"/>
                            <Settings addRunlineName="no">
                                <Selection object="{stbd_id}"/> 
                                <Singlebeam maxInterpolDist="-1" interpolateDepth="yes"/>
                                <Multibeam averagingWindow="1.0"/> 
                                <NoOfDecimals position="3" depth="3" />
                                <Options downsampleFactor="0" downsampleMinDist="0.0" timeFormat="0" />
                            </Settings>
                        </Export>
                    </NaviEditTask>
                </ExportAsciiTask>

            </GroupTask>
        </FindBlocksTask>
    </GroupTask>
</Setup>
